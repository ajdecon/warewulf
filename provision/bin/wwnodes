#!/usr/bin/perl -Tw
#
# Copyright (c) 2003-2010, The Regents of the University of California,
# through Lawrence Berkeley National Laboratory (subject to receipt of any
# required approvals from the U.S. Dept. of Energy).  All rights reserved.
#
# This program is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by the
# Free Software Foundation; either version 2 of the License, or (at your
# option) any later version.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
# or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
# for more details.
#
# The GNU GPL Document can be found at:
# http://www.gnu.org/copyleft/gpl.html
#

use Warewulf::DB;
use Warewulf::Logger;
use Warewulf::Config;
use Getopt::Long;

Getopt::Long::Configure ("bundling");

my $debug;
my $verbose;
my $cluster;


GetOptions(
    'd|debug' => \$debug,
    'v|verbose' => \$verbose,
    'c|cluster=s' => \$cluster,
);

if ($debug) {
    set_log_level(DEBUG);
} elsif ($verbose) {
    set_log_level(NOTICE);
} else {
    set_log_level(INFO);
}

my $db = Warewulf::DB->new();
my $config = Warewulf::Config->new();

$db->driver("mysql");
$db->host($config->get("database server"));
$db->database($config->get("database name"));
$db->user($config->get("database user"));
$db->passwd($config->get("database password"));
$db->connect();


my $command = shift(@ARGV);


if ($command eq "add") {
    my $name = shift(@ARGV);

    if ($name) {
        if ($name =~ /^([a-zA-Z0-9\-_]+)$/) {
            $db->command("INSERT INTO nodes (name,cluster) VALUES (?,?)", $1, $cluster);
        } elsif ($name) {
            &eprint("Illegal characters for node name\n");
        }
    } else {
        &eprint("Please supply a node name\n");
    }

} elsif ($command eq "set") {

} elsif ($command eq "list") {
    $db->command("SELECT name FROM nodes");
    while (my ($node) = $db->fetch_row()) {
        print "$node\n";
    }
}
