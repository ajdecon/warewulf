%{!?_rel:%{expand:%%global _rel 0.r%(test "@SVNVERSION@" != "0000" && echo "@SVNVERSION@" || svnversion | sed 's/[^0-9].*$//' | grep '^[0-9][0-9]*$' || echo 0000)}}

Name: warewulf-common
Summary: A suite of tools for clustering
Version: @PACKAGE_VERSION@
Release: %{_rel}
License: BSD
Group: System Environment/Clustering
Source: %{name}-%{version}.tar.gz
ExclusiveOS: linux
BuildArch: noarch
Conflicts: warewulf <= 2.9
BuildRoot: %{?_tmppath}/%{name}-%{version}-%{release}-root

%description
Warewulf >= 3 is a set of utilities designed to better enable
utilization and maintenance of clusters or groups of computers.

This is the main package which includes the main daemon and
supporting libs.

%prep
%setup -q

%build
%configure
%{__make} %{?mflags}

%install
%{__make} install DESTDIR=$RPM_BUILD_ROOT %{?mflags_install}

%pre
groupadd -r warewulf >/dev/null 2>&1 || :

%post
service mysqld start >/dev/null 2>&1 || :
chkconfig mysqld on >/dev/null 2>&1 || :


%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-, root, root)
%doc AUTHORS COPYING ChangeLog INSTALL NEWS README TODO LICENSE
%attr(0710, root, warewulf) %dir %{_sysconfdir}/warewulf/
%attr(0640, root, warewulf) %config(noreplace) %{_sysconfdir}/warewulf/database.conf
%attr(0644, root, root) %config(noreplace) %{_sysconfdir}/warewulf/wwfunctions
%{_bindir}/*
%{_datadir}/warewulf/
%{perl_vendorlib}/*

%changelog
